<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="9/9/2019 5:03:05 PM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="INV060333"
  DTS:CreatorName="OCDE\AurélieAtta"
  DTS:DTSID="{15E15F16-27F4-4E83-8F2F-649D25986ABB}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.2000.132"
  DTS:LocaleID="1033"
  DTS:ObjectName="OCDE_DWH_Manifestation_DM"
  DTS:PackageType="5"
  DTS:VersionBuild="108"
  DTS:VersionGUID="{04EB78A3-A9BA-4342-A54D-7DA824E46123}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:Variables />
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\TSQL MERGE INTO DWH_Manifestation_DM"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{849493e1-8dec-4226-b651-da7501aabcd7}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="TSQL MERGE INTO DWH_Manifestation_DM"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{B0DC49FE-B31E-4725-AD3B-5BB1D1A9DFE8}"
          SQLTask:SqlStatementSource="&#x9;INSERT INTO [dwh].[Manifestation_DM]&#xA;           ([Manifestation_ExternalID]&#xA;           ,[ExternalSource]&#xA;           ,[Expression_ID]&#xA;           ,[Format_ID] &#xA;           ,[FirstRelease_Date]&#xA;           ,[LastUpdate_Date]&#xA;           ,[HideInReport]&#xA;           ,[NA_Import]&#xA;           ,[IsCurrent]&#xA;           ,[ValidFrom]&#xA;           ,[ValidTo])&#xA;        SELECT&#xA;&#x9;&#x9;&#x9; [Manifestation_ExternalID]&#xA;&#x9;&#x9;&#x9;,[ExternalSource]&#xA;&#x9;&#x9;&#x9;,[Expression_ID]&#xA;&#x9;&#x9;&#x9;,[Format_ID] &#xA;&#x9;&#x9;&#x9;,[FirstRelease_Date]&#xA;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,1&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,NULL&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;FROM (&#xA;&#x9;&#x9;  MERGE [dwh].Manifestation_DM&#x9;&#x9;&#x9;&#x9;&#x9;AS [Target]&#xA;&#x9;&#x9;  USING stg.STG_Manifestation_DM_SA&#x9;&#x9;&#x9;AS [Source]&#xA;&#x9;&#x9;&#x9; ON&#x9; Target.[Manifestation_ExternalID]&#x9;&#x9;&#x9;= Source.[Manifestation_ExternalID]&#xA;&#x9;&#x9;&#x9; AND Target.[ExternalSource]&#x9;&#x9;&#x9;&#x9;&#x9;= Source.[ExternalSource]&#xA;&#x9;&#x9;&#x9; AND Target.[Format_ID]&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;= Source.[Format_ID] &#x9;&#xA;&#x9;&#x9;&#x9; AND Target.IsCurrent = 1&#xA;&#x9;&#x9;  WHEN MATCHED AND&#xA;&#x9;&#x9;&#x9;  (&#xA;&#x9;&#x9;&#x9;&#x9;   Target.[Expression_ID]&#x9;&#x9;&#x9;&#x9;&lt;&gt; Source.[Expression_ID]&#xA;&#x9;&#x9;&#x9;  )&#xA;&#x9;&#x9;&#x9;  -- When some data of the record has been changed in operational database&#xA;&#x9;&#x9;&#x9;  --&#x9;&#x9;We flag the old row&#xA;&#x9;&#x9;&#x9;  --&#x9;&#x9;New row is inserted in upper insert clause&#xA;&#x9;&#x9;&#x9;  THEN UPDATE SET&#xA;&#x9;&#x9;&#x9;&#x9; LastUpdate_Date    = GETDATE()&#xA;&#x9;&#x9;&#x9;&#x9;,NA_Import&#x9;&#x9;&#x9;= 1 &#xA;&#x9;&#x9;&#x9;&#x9;,IsCurrent   &#x9;&#x9;= 0&#xA;&#x9;&#x9;&#x9;&#x9;,ValidTo&#x9;&#x9;&#x9;= GETDATE()&#xA;&#x9;&#x9;  WHEN NOT MATCHED BY TARGET&#xA;&#x9;&#x9;&#x9;&#x9;-- When data a record has been created in operational database&#xA;&#x9;&#x9;&#x9;  THEN INSERT (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9; [Manifestation_ExternalID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ExternalSource]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Expression_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Format_ID] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[FirstRelease_Date]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[LastUpdate_Date]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[HideInReport]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[NA_Import]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[IsCurrent]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ValidFrom]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ValidTo]&#xA;&#x9;&#x9;&#x9;&#x9;) VALUES (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9; Source.[Manifestation_ExternalID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[ExternalSource]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Expression_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Format_ID] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[FirstRelease_Date]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,1&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,NULL&#x9;&#x9;   &#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;  -- ****** use if you want to delete a row corresponding at a record that has been deleted in operational database ****&#xA;&#x9;&#x9;  --WHEN NOT MATCHED BY SOURCE&#xA;&#x9;&#x9;  --    THEN UPDATE SET&#xA;&#x9;&#x9;  -- ***********************&#xA;&#x9;&#x9;  &#xA;&#x9;&#x9;  OUTPUT $action AS Action&#xA;&#x9;&#x9;&#x9;&#x9;,[Source].*&#xA;&#x9;&#x9;) AS MergeOutput&#xA;&#x9;&#x9;WHERE MergeOutput.Action = 'UPDATE'&#xA;&#x9;&#x9;  AND [Manifestation_ExternalID] IS NOT NULL&#xA;&#x9;&#x9;;&#xA;&#x9;&#x9;&#xA;&#x9;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\TSQL MERGE INTO DWH_Manifestation_DM (StatLink)"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{f5fbbe30-9381-438d-a61c-35523b6fde5e}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="TSQL MERGE INTO DWH_Manifestation_DM (StatLink)"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{B0DC49FE-B31E-4725-AD3B-5BB1D1A9DFE8}"
          SQLTask:SqlStatementSource="&#x9;&#x9;INSERT INTO [dwh].[Manifestation_DM]&#xA;           ([Manifestation_ExternalID]&#xA;           ,[ExternalSource]&#xA;           ,[Expression_ID]&#xA;           ,[Format_ID] &#xA;           ,[FirstRelease_Date]&#xA;           ,[LastUpdate_Date]&#xA;           ,[HideInReport]&#xA;           ,[NA_Import]&#xA;           ,[IsCurrent]&#xA;           ,[ValidFrom]&#xA;           ,[ValidTo])&#xA;        SELECT&#xA;&#x9;&#x9;&#x9; [Manifestation_ExternalID]&#xA;&#x9;&#x9;&#x9;,[ExternalSource]&#xA;&#x9;&#x9;&#x9;,[Expression_ID]&#xA;&#x9;&#x9;&#x9;,[Format_ID] &#xA;&#x9;&#x9;&#x9;,[FirstRelease_Date]&#xA;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,1&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,NULL&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;FROM (&#xA;&#x9;&#x9;  MERGE [dwh].Manifestation_DM&#x9;&#x9;&#x9;&#x9;&#x9;AS [Target]&#xA;&#x9;&#x9;  USING stg.STG_Manifestation_StatLink_DM_SA&#x9;&#x9;&#x9;AS [Source]&#xA;&#x9;&#x9;&#x9; ON&#x9; Target.[Manifestation_ExternalID]&#x9;&#x9;&#x9;= Source.[Manifestation_ExternalID]&#xA;&#x9;&#x9;&#x9; AND Target.[ExternalSource]='SL'&#xA;&#x9;&#x9;&#x9; AND Target.IsCurrent = 1&#xA;&#x9;&#x9;  WHEN MATCHED AND&#xA;&#x9;&#x9;&#x9;  (&#xA;&#x9;&#x9;&#x9;&#x9;   Target.[Expression_ID]&#x9;&#x9;&#x9;&#x9;&lt;&gt; Source.[Expression_ID]&#xA;&#x9;&#x9;&#x9;&#x9;OR Target.[Format_ID]&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; Source.[Format_ID] &#x9;&#xA;&#x9;&#x9;&#x9;  )&#xA;&#x9;&#x9;&#x9;  -- When some data of the record has been changed in operational database&#xA;&#x9;&#x9;&#x9;  --&#x9;&#x9;We flag the old row&#xA;&#x9;&#x9;&#x9;  --&#x9;&#x9;New row is inserted in upper insert clause&#xA;&#x9;&#x9;&#x9;  THEN UPDATE SET&#xA;&#x9;&#x9;&#x9;&#x9; LastUpdate_Date    = GETDATE()&#xA;&#x9;&#x9;&#x9;&#x9;,NA_Import&#x9;&#x9;&#x9;= 1 &#xA;&#x9;&#x9;&#x9;&#x9;,IsCurrent   &#x9;&#x9;= 0&#xA;&#x9;&#x9;&#x9;&#x9;,ValidTo&#x9;&#x9;&#x9;= GETDATE()&#xA;&#x9;&#x9;  WHEN NOT MATCHED BY TARGET&#xA;&#x9;&#x9;&#x9;&#x9;-- When data a record has been created in operational database&#xA;&#x9;&#x9;&#x9;  THEN INSERT (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9; [Manifestation_ExternalID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ExternalSource]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Expression_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Format_ID] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[FirstRelease_Date]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[LastUpdate_Date]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[HideInReport]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[NA_Import]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[IsCurrent]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ValidFrom]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ValidTo]&#xA;&#x9;&#x9;&#x9;&#x9;) VALUES (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9; Source.[Manifestation_ExternalID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[ExternalSource]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Expression_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Format_ID] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[FirstRelease_Date]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,1&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,NULL&#x9;&#x9;    &#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;  -- ****** use if you want to delete a row corresponding at a record that has been deleted in operational database ****&#xA;&#x9;&#x9;  --WHEN NOT MATCHED BY SOURCE&#xA;&#x9;&#x9;  --    THEN UPDATE SET&#xA;&#x9;&#x9;  -- ***********************&#xA;&#x9;&#x9;  &#xA;&#x9;&#x9;  OUTPUT $action AS Action&#xA;&#x9;&#x9;&#x9;&#x9;,[Source].*&#xA;&#x9;&#x9;) AS MergeOutput&#xA;&#x9;&#x9;WHERE MergeOutput.Action = 'UPDATE'&#xA;&#x9;&#x9;  AND [Manifestation_ExternalID] IS NOT NULL&#xA;&#x9;&#x9;;&#xA;&#xA;&#x9;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:PrecedenceConstraints>
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Contrainte 1]"
      DTS:CreationName=""
      DTS:DTSID="{B1885D08-402D-48C6-914B-F9AC9D5D1C5B}"
      DTS:From="Package\TSQL MERGE INTO DWH_Manifestation_DM"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Contrainte 1"
      DTS:To="Package\TSQL MERGE INTO DWH_Manifestation_DM (StatLink)" />
  </DTS:PrecedenceConstraints>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--Cette section CDATA contient des informations sur la disposition du package. Elle comprend des informations telles que les coordonnées (x,y), la largeur et la hauteur.-->
<!--Si vous modifiez manuellement cette section et commettez une erreur, vous pouvez la supprimer. -->
<!--Le package pourra toujours se charger normalement, mais les informations de disposition précédente seront perdues et le concepteur réorganisera automatiquement les éléments sur l'aire de conception.-->
<Objects
  Version="8">
  <!--Chaque nœud ci-dessous contiendra des propriétés qui n'affectent pas le comportement d'exécution.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml">
        <NodeLayout
          Size="288,42.6666666666667"
          Id="Package\TSQL MERGE INTO DWH_Manifestation_DM"
          TopLeft="68.1250001396986,34.4122715837289" />
        <NodeLayout
          Size="337.333333333334,42"
          Id="Package\TSQL MERGE INTO DWH_Manifestation_DM (StatLink)"
          TopLeft="49.0833333892128,113.131569378593" />
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Contrainte 1]"
          TopLeft="214.937500097789,77.0789382503957">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,36.0526311281973"
              Start="0,0"
              End="0,28.5526311281973">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,28.5526311281973" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>