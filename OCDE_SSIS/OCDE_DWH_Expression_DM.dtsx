<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="9/9/2019 5:03:05 PM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="INV060333"
  DTS:CreatorName="OCDE\AurélieAtta"
  DTS:DTSID="{6FA73F8A-7118-497A-8C9A-D3F3869E88BE}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.2000.132"
  DTS:LocaleID="1033"
  DTS:ObjectName="OCDE_DWH_Expression_DM"
  DTS:PackageType="5"
  DTS:VersionBuild="156"
  DTS:VersionGUID="{2D9CB09C-4B40-45CD-BB40-27CADF95518F}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:Variables />
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\TSQL MERGE INTO DWH_Expression (StatLinks)"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{9696f0c4-1538-47d7-afe2-60cb53779d13}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="TSQL MERGE INTO DWH_Expression (StatLinks)"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{B0DC49FE-B31E-4725-AD3B-5BB1D1A9DFE8}"
          SQLTask:SqlStatementSource="&#xA;INSERT INTO [dwh].[Expression_DM]&#xA;           ([Expression_ExternalID]&#xA;           ,[ExternalSource]&#xA;           ,[DOI]&#xA;           ,[ISSN] &#xA;           ,[Title]&#xA;           ,[SubTitle] &#xA;           ,[Language_ID]&#xA;           ,[Directorate_ID]&#xA;           ,[Theme_ID]&#xA;           ,[Igo_ID]&#xA;           ,[ObjectType_ID]&#xA;           ,[FirstRelease_Date]&#xA;           ,[iLibraryURLAlias] &#xA;           ,[LastUpdate_Date]&#xA;           ,[HideInReport]&#xA;           ,[NA_Import]&#xA;           ,[IsCurrent]&#xA;           ,[ValidFrom]&#xA;&#x9;&#x9;   ,[ValidTo]&#xA;&#x9;&#x9;   ,[FirstExportDate]&#xA;&#x9;&#x9;   ,[LatestExportDate]&#xA;&#x9;&#x9;   ,[LatestDeletionDate])&#xA;        SELECT&#xA;&#x9;&#x9;&#x9; [Expression_ExternalID]&#xA;&#x9;&#x9;&#x9;,[ExternalSource]&#xA;&#x9;&#x9;&#x9;,[DOI]&#xA;&#x9;&#x9;&#x9;,[ISSN] &#xA;&#x9;&#x9;&#x9;,[Title]&#xA;&#x9;&#x9;&#x9;,[SubTitle] &#xA;&#x9;&#x9;&#x9;,[Language_ID]&#xA;&#x9;&#x9;&#x9;,[Directorate_ID]&#xA;&#x9;&#x9;&#x9;,[Theme_ID]&#xA;&#x9;&#x9;&#x9;,IGOId_ID&#xA;&#x9;&#x9;&#x9;,[ObjectType_ID]&#xA;&#x9;&#x9;&#x9;,[FirstRelease_Date]&#xA;&#x9;&#x9;&#x9;,[iLibraryURLAlias] &#xA;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,1&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,NULL&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;   ,[FirstExportDate]&#xA;&#x9;&#x9;   ,[LatestExportDate]&#xA;&#x9;&#x9;   ,[LatestDeletionDate]&#xA;&#x9;&#x9;FROM (&#xA;&#x9;&#x9;  MERGE [dwh].Expression_DM&#x9;&#x9;&#x9;&#x9;&#x9;AS [Target]&#xA;&#x9;&#x9;  USING stg.STG_Expression_StatLinks_DM_SA&#x9;&#x9;&#x9;AS [Source]&#xA;&#x9;&#x9;&#x9; ON&#x9; Target.[Expression_ExternalID]&#x9;&#x9;&#x9;&#x9;=( Source.[Expression_ExternalID] collate Latin1_General_CI_AS)&#xA;&#x9;&#x9;&#x9; AND Target.[ExternalSource]&#x9;&#x9;&#x9;&#x9;&#x9;=( Source.[ExternalSource] collate Latin1_General_CI_AS)&#xA;&#x9;&#x9;  WHEN MATCHED AND Target.IsCurrent = 1 AND&#xA;&#x9;&#x9;&#x9;  (&#xA;&#x9;&#x9;&#x9;&#x9;   ISNULL(Target.[DOI],'')&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; ISNULL((Source.[DOI]  collate Latin1_General_CI_AS),'') &#xA;&#xA;&#x9;&#x9;&#x9;&#x9;--OR ISNULL(Target.[DefaultParent_ID],'')&#x9;&#x9;&lt;&gt; ISNULL(Source.[Parent_ID],'')&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  )&#xA;&#x9;&#x9;&#x9;  -- When some data of the record has been changed in operational database&#xA;&#x9;&#x9;&#x9;  --&#x9;&#x9;We flag the old row&#xA;&#x9;&#x9;&#x9;  --&#x9;&#x9;New row is inserted in upper insert clause&#xA;&#x9;&#x9;&#x9;  THEN UPDATE SET&#xA;&#x9;&#x9;&#x9;&#x9; LastUpdate_Date    = GETDATE()&#xA;&#x9;&#x9;&#x9;&#x9;,NA_Import&#x9;&#x9;&#x9;= 1 &#xA;&#x9;&#x9;&#x9;&#x9;,IsCurrent   &#x9;&#x9;= 0&#xA;&#x9;&#x9;&#x9;&#x9;,ValidTo&#x9;&#x9;&#x9;= GETDATE()&#xA;&#x9;&#x9;  WHEN NOT MATCHED BY TARGET&#xA;&#x9;&#x9;&#x9;&#x9;-- When data a record has been created in operational database&#xA;&#xA;&#x9;&#x9;&#x9;  THEN INSERT (&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9; [Expression_ExternalID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ExternalSource]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[DOI]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ISSN] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Title]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[SubTitle] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Language_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Directorate_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Theme_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Igo_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ObjectType_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[FirstRelease_Date]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[iLibraryURLAlias] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[LastUpdate_Date]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[HideInReport]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[NA_Import]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[IsCurrent]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ValidFrom]&#xA;&#x9;&#x9;&#x9;        ,[ValidTo]&#xA;&#x9;&#x9;&#x9;&#x9;    ,[FirstExportDate]&#xA;&#x9;&#x9;&#x9;&#x9;    ,[LatestExportDate]&#xA;&#x9;&#x9;&#x9;&#x9;    ,[LatestDeletionDate]&#xA;&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;) VALUES (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9; Source.[Expression_ExternalID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[ExternalSource]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[DOI]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[ISSN] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Title]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[SubTitle] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Language_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Directorate_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Theme_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Igo_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[ObjectType_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[FirstRelease_Date]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[iLibraryURLAlias] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,1&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,NULL&#x9;&#x9;   &#xA;&#x9;&#x9;&#x9;&#x9;    ,[FirstExportDate]&#xA;&#x9;&#x9;&#x9;&#x9;    ,[LatestExportDate]&#xA;&#x9;&#x9;&#x9;&#x9;    ,[LatestDeletionDate]&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;  -- ****** use if you want to delete a row corresponding at a record that has been deleted in operational database ****&#xA;&#x9;&#x9;  --WHEN NOT MATCHED BY SOURCE&#xA;&#x9;&#x9;  --    THEN UPDATE SET&#xA;&#x9;&#x9;  -- ***********************&#xA;&#x9;&#x9;  &#xA;&#x9;&#x9;  OUTPUT $action AS Action&#xA;&#x9;&#x9;&#x9;&#x9;,[Source].*&#xA;&#x9;&#x9;) AS MergeOutput&#xA;&#x9;&#x9;WHERE MergeOutput.Action = 'UPDATE'&#xA;&#x9;&#x9;  AND [Expression_ExternalID] IS NOT NULL&#xA;&#x9;&#x9;;&#xA;&#x9;&#x9;&#xA;&#xA;&#x9;&#x9;  -- ****** Update of attributes [Title]   [iLibraryURLAlias]   ****&#xA;&#xA;&#x9;&#x9;  &#xA;&#x9;&#x9;Update [dwh].Expression_DM&#xA;&#xA;&#x9;&#x9;Set &#xA;&#xA;&#x9;&#x9;&#x9;   Expression_DM.[Title] = isnull(EXPD.[Title],'')  &#xA;&#x9;&#x9;&#x9;  ,Expression_DM.[iLibraryURLAlias]= isnull(EXPD.[iLibraryURLAlias],'')  &#xA;&#x9;&#x9;&#x9; &#xA;&#x9;&#x9;FROM [dwh].Expression_DM INNER JOIN &#xA; &#xA;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;select * from (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;DOI  &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Title]   &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[iLibraryURLAlias] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,ROW_NUMBER() OVER (PARTITION BY DOI ORDER BY SourceRn,rn ASC) AS rn2&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;From (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;SELECT &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;DOI collate Latin1_General_CI_AS as DOI &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Title] collate Latin1_General_CI_AS as [Title] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[iLibraryURLAlias] collate Latin1_General_CI_AS as [iLibraryURLAlias]  &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,2 as SourceRn&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  ,ROW_NUMBER() OVER (PARTITION BY DOI ORDER BY [ExpressionId] DESC) AS rn&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;[stg].[STG_Expression_StatLink_OP] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;where DOI is not null and DOI &lt;&gt;''  &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;)t&#xA;&#x9;&#x9;&#x9;&#x9;)t2 &#xA;&#x9;&#x9;&#x9;&#x9;where t2.rn2=1&#xA;&#x9;&#x9;) EXPD &#xA;&#x9;&#x9;on Expression_DM.DOI=EXPD.DOI   &#xA;&#x9;&#x9;and Expression_DM.ExternalSource='SL' &#xA;&#xA;&#x9;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\TSQL MERGE INTO DWH_Expression_DM"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{0B9A61B5-7F29-49E6-8441-5A0B482834E6}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="TSQL MERGE INTO DWH_Expression_DM"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{B0DC49FE-B31E-4725-AD3B-5BB1D1A9DFE8}"
          SQLTask:SqlStatementSource="INSERT INTO [dwh].[Expression_DM]&#xA;           ([Expression_ExternalID]&#xA;           ,[ExternalSource]&#xA;           ,[DOI]&#xA;           ,[ISSN] &#xA;           ,[Title]&#xA;           ,[SubTitle] &#xA;           ,[Language_ID]&#xA;           ,[Directorate_ID]&#xA;           ,[Theme_ID]&#xA;           ,[Igo_ID]&#xA;           ,[ObjectType_ID]&#xA;           ,[FirstRelease_Date]&#xA;           ,[iLibraryURLAlias] &#xA;           ,[LastUpdate_Date]&#xA;           ,[HideInReport]&#xA;           ,[NA_Import]&#xA;           ,[IsCurrent]&#xA;           ,[ValidFrom]&#xA;&#x9;&#x9;   ,[ValidTo]&#xA;&#x9;&#x9;   ,[FirstExportDate]&#xA;&#x9;&#x9;   ,[LatestExportDate]&#xA;&#x9;&#x9;   ,[LatestDeletionDate])&#xA;        SELECT&#xA;&#x9;&#x9;&#x9; [Expression_ExternalID]&#xA;&#x9;&#x9;&#x9;,[ExternalSource]&#xA;&#x9;&#x9;&#x9;,[DOI]&#xA;&#x9;&#x9;&#x9;,[ISSN] &#xA;&#x9;&#x9;&#x9;,[Title]&#xA;&#x9;&#x9;&#x9;,[SubTitle] &#xA;&#x9;&#x9;&#x9;,[Language_ID]&#xA;&#x9;&#x9;&#x9;,Directorate_lID&#xA;&#x9;&#x9;&#x9;,[Theme_ID]&#xA;&#x9;&#x9;&#x9;,[IGO_ID]&#xA;&#x9;&#x9;&#x9;,[ObjectType_ID]&#xA;&#x9;&#x9;&#x9;,[FirstRelease_Date]&#xA;&#x9;&#x9;&#x9;,[iLibraryURLAlias] &#xA;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,1&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,NULL&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;   ,[FirstExportDate]&#xA;&#x9;&#x9;   ,[LatestExportDate]&#xA;&#x9;&#x9;   ,[LatestDeletionDate]&#xA;&#x9;&#x9;FROM (&#xA;&#x9;&#x9;  MERGE [dwh].Expression_DM&#x9;&#x9;&#x9;&#x9;&#x9;AS [Target]&#xA;&#x9;&#x9;  USING stg.STG_Expression_DM_SA&#x9;&#x9;&#x9;AS [Source]&#xA;&#x9;&#x9;&#x9; ON&#x9; Target.[Expression_ExternalID]&#x9;&#x9;&#x9;&#x9;= Source.[Expression_ExternalID]&#xA;&#x9;&#x9;&#x9; AND Target.[ExternalSource]&#x9;&#x9;&#x9;&#x9;&#x9;= Source.[ExternalSource]&#xA;&#x9;&#x9;  WHEN MATCHED AND Target.IsCurrent = 1 AND&#xA;&#x9;&#x9;&#x9;  (&#xA;&#x9;&#x9;&#x9;&#x9;   ISNULL(Target.[DOI],'')&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; ISNULL(Source.[DOI],'') &#xA;&#x9;&#x9;&#x9;&#x9;OR Target.[Language_ID]&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; Source.[Language_ID]&#xA;&#x9;&#x9;&#x9;&#x9;OR Target.[Directorate_ID]&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; Source.[Directorate_ID]&#xA;&#x9;&#x9;&#x9;&#x9;OR Target.[Theme_ID]&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; Source.[Theme_ID]&#xA;&#x9;&#x9;&#x9;&#x9;OR Target.[IGO_ID]&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; Source.[IGO_ID]&#xA;&#x9;&#x9;&#x9;&#x9;OR Target.[ObjectType_ID]&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; Source.[ObjectType_ID]&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;--OR ISNULL(Target.[DefaultParent_ID],'')&#x9;&#x9;&lt;&gt; ISNULL(Source.[Parent_ID],'')&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;  )&#xA;&#x9;&#x9;&#x9;  -- When some data of the record has been changed in operational database&#xA;&#x9;&#x9;&#x9;  --&#x9;&#x9;We flag the old row&#xA;&#x9;&#x9;&#x9;  --&#x9;&#x9;New row is inserted in upper insert clause&#xA;&#x9;&#x9;&#x9;  THEN UPDATE SET&#xA;&#x9;&#x9;&#x9;&#x9; LastUpdate_Date    = GETDATE()&#xA;&#x9;&#x9;&#x9;&#x9;,NA_Import&#x9;&#x9;&#x9;= 1 &#xA;&#x9;&#x9;&#x9;&#x9;,IsCurrent   &#x9;&#x9;= 0&#xA;&#x9;&#x9;&#x9;&#x9;,ValidTo&#x9;&#x9;&#x9;= GETDATE()&#xA;&#x9;&#x9;  WHEN NOT MATCHED BY TARGET&#xA;&#x9;&#x9;&#x9;&#x9;-- When data a record has been created in operational database&#xA;&#x9;&#x9;&#x9;  THEN INSERT (&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9; [Expression_ExternalID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ExternalSource]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[DOI]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ISSN] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Title]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[SubTitle] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Language_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Directorate_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Theme_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[Igo_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ObjectType_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[FirstRelease_Date]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[iLibraryURLAlias] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[LastUpdate_Date]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[HideInReport]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[NA_Import]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[IsCurrent]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,[ValidFrom]&#xA;&#x9;&#x9;&#x9;        ,[ValidTo]&#xA;&#x9;&#x9;&#x9;&#x9;    ,[FirstExportDate]&#xA;&#x9;&#x9;&#x9;&#x9;    ,[LatestExportDate]&#xA;&#x9;&#x9;&#x9;&#x9;    ,[LatestDeletionDate]&#xA;&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;) VALUES (&#xA;&#x9;&#x9;&#x9;&#x9;&#x9; Source.[Expression_ExternalID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[ExternalSource]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[DOI]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[ISSN] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Title]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[SubTitle] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Language_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Directorate_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Theme_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[Igo_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[ObjectType_ID]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[FirstRelease_Date]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,Source.[iLibraryURLAlias] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,1&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;,NULL&#x9;&#x9;    &#xA;&#x9;&#x9;&#x9;&#x9;    ,[FirstExportDate]&#xA;&#x9;&#x9;&#x9;&#x9;    ,[LatestExportDate]&#xA;&#x9;&#x9;&#x9;&#x9;    ,[LatestDeletionDate]&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;  -- ****** use if you want to delete a row corresponding at a record that has been deleted in operational database ****&#xA;&#x9;&#x9;  --WHEN NOT MATCHED BY SOURCE&#xA;&#x9;&#x9;  --    THEN UPDATE SET&#xA;&#x9;&#x9;  -- ***********************&#xA;&#x9;&#x9;  &#xA;&#x9;&#x9;  OUTPUT $action AS Action&#xA;&#x9;&#x9;&#x9;&#x9;,[Source].*&#xA;&#x9;&#x9;) AS MergeOutput&#xA;&#x9;&#x9;WHERE MergeOutput.Action = 'UPDATE'&#xA;&#x9;&#x9;  AND [Expression_ExternalID] IS NOT NULL&#xA;&#x9;&#x9;;&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;  -- ****** Update of attributes [FirstReleaseDate] [FirstExportDate] [LatestExportDate] [LatestDeletionDate] ****&#xA;&#x9;&#x9;  &#xA;&#xA;&#x9;&#x9;  &#xA;&#x9;&#x9;Update [dwh].Expression_DM&#xA;&#xA;&#x9;&#x9;Set &#xA;&#xA;&#x9;&#x9;&#x9;   Expression_DM.FirstRelease_Date= EXPD.[FirstReleaseDate]&#xA;&#x9;&#x9;&#x9;  ,Expression_DM.[FirstExportDate]= EXPD.[FirstExportDate]&#xA;&#x9;&#x9;&#x9;  ,Expression_DM.[LatestExportDate]= EXPD.[LatestExportDate]&#xA;&#x9;&#x9;&#x9;  ,Expression_DM.[LatestDeletionDate] = EXPD.[LatestDeletionDate]  &#xA;&#xA;&#x9;&#x9;&#x9; &#xA;&#x9;&#x9;FROM [dwh].Expression_DM LEFT OUTER JOIN &#xA;&#xA;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;select * from (SELECT &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;DOI&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;,[FirstReleaseDate]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;,[FirstExportDate]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;,[LatestExportDate]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;,[LatestDeletionDate]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;,ROW_NUMBER() OVER (PARTITION BY DOI ORDER BY rn ASC) AS rn2&#xA;&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;FROM&#xA;&#x9;&#x9;&#x9;&#x9;(&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;SELECT DOI collate Latin1_General_CI_AS as DOI&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,min(case when [FirstRelease_Date] is not null then [FirstRelease_Date] end) as [FirstReleaseDate]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,min(case when [FirstExportDate] is not null then [FirstExportDate] end)  as [FirstExportDate]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,max(case when [LatestExportDate] is not null then [LatestExportDate] end) as [LatestExportDate]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,max(case when [LatestDeletionDate] is not null then [LatestDeletionDate] end) as [LatestDeletionDate]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,1 as rn&#xA;&#x9;&#x9;&#x9;&#x9;  FROM [stg].[STG_Expression_SA_OP] where DOI is not null and DOI &lt;&gt;'' and [FirstExportDate]is not null&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;  Group By DOI  ) t) t2 where t2.rn2=1&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;) EXPD on Expression_DM.DOI=EXPD.DOI  &#xA;&#x9;&#x9;&#xA;&#x9;&#x9;where EXPD.DOI is not null and  EXPD.DOI &lt;&gt;'' &#xA;&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;  -- ****** Update of attributes [ISSN] [Title] [SubTitle] [iLibraryURLAlias] [iLibraryAccessMode] ****&#xA;&#xA;&#x9;&#x9;  &#xA;&#x9;&#x9;Update [dwh].Expression_DM&#xA;&#xA;&#x9;&#x9;Set &#xA;&#xA;&#x9;&#x9;&#x9;  Expression_DM.[ISSN] = isnull(EXPD.[ISSN],'')  &#xA;&#x9;&#x9;&#x9;  ,Expression_DM.[Title] = isnull(EXPD.[Title],'')  &#xA;&#x9;&#x9;&#x9;  ,Expression_DM.[SubTitle] = isnull(EXPD.[SubTitle],'')  &#xA;&#x9;&#x9;&#x9;  ,Expression_DM.[iLibraryURLAlias]= isnull(EXPD.[iLibraryURLAlias],'')  &#xA;&#x9;&#x9;&#x9;  ,Expression_DM.[iLibraryAccessMode]= isnull(EXPD.[iLibraryAccessMode],'')  &#xA;&#x9;&#x9;&#x9; &#xA;&#x9;&#x9;FROM [dwh].Expression_DM INNER JOIN &#xA; &#xA;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;select * from (SELECT DOI&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[ISSN]  &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Title] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[SubTitle] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[iLibraryURLAlias]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[iLibraryAccessMode]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,ROW_NUMBER() OVER (PARTITION BY DOI ORDER BY SourceRn,rn ASC) AS rn2&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  From&#xA;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;(&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;SELECT DOI collate Latin1_General_CI_AS as DOI&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[ISSN] collate Latin1_General_CI_AS as [ISSN]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[Title] collate Latin1_General_CI_AS as [Title]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[SubTitle] collate Latin1_General_CI_AS as [SubTitle] &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[iLibraryURLAlias] collate Latin1_General_CI_AS as [iLibraryURLAlias]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,[iLibraryAccessTypeId]  as [iLibraryAccessMode]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,1 as SourceRn&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  ,ROW_NUMBER() OVER (PARTITION BY DOI ORDER BY [ProductId] DESC) AS rn&#xA;&#x9;&#x9;&#x9;&#x9;  FROM [stg].[STG_Expression] where DOI is not null and DOI &lt;&gt;'' &#xA;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;)t)t2 where t2.rn2=1) EXPD on Expression_DM.DOI=EXPD.DOI  &#xA;&#x9;&#x9;&#xA;&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:PrecedenceConstraints>
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Contrainte]"
      DTS:CreationName=""
      DTS:DTSID="{E0DC75DC-FE68-4AD0-BE20-A28C53BFF9B5}"
      DTS:From="Package\TSQL MERGE INTO DWH_Expression_DM"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Contrainte"
      DTS:To="Package\TSQL MERGE INTO DWH_Expression (StatLinks)" />
  </DTS:PrecedenceConstraints>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--Cette section CDATA contient des informations sur la disposition du package. Elle comprend des informations telles que les coordonnées (x,y), la largeur et la hauteur.-->
<!--Si vous modifiez manuellement cette section et commettez une erreur, vous pouvez la supprimer. -->
<!--Le package pourra toujours se charger normalement, mais les informations de disposition précédente seront perdues et le concepteur réorganisera automatiquement les éléments sur l'aire de conception.-->
<Objects
  Version="8">
  <!--Chaque nœud ci-dessous contiendra des propriétés qui n'affectent pas le comportement d'exécution.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml">
        <NodeLayout
          Size="308,42.6666666666667"
          Id="Package\TSQL MERGE INTO DWH_Expression (StatLinks)"
          TopLeft="14.8020840589892,129.769716107165" />
        <NodeLayout
          Size="274.666666666667,42.6666666666667"
          Id="Package\TSQL MERGE INTO DWH_Expression_DM"
          TopLeft="29.6458340861525,37.9692987614011" />
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Contrainte]"
          TopLeft="167.890625739237,80.6359654280677">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,49.1337506790972"
              Start="0,0"
              End="0,41.6337506790972">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,41.6337506790972" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>