<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="9/9/2019 5:03:05 PM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="INV060333"
  DTS:CreatorName="OCDE\AurélieAtta"
  DTS:DTSID="{CCB03AE5-C1EC-43CE-90AB-B53EDA52EA46}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.2000.132"
  DTS:LocaleID="1033"
  DTS:ObjectName="OCDE_DWH_Registration_DM"
  DTS:PackageType="5"
  DTS:VersionBuild="77"
  DTS:VersionGUID="{2BBE2207-4B2E-4166-ACA3-10A9171D9DB1}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:Variables />
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\TSQL INSERT INTO DWH_Registration_DM"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{4EF10962-90DD-4CC4-B2B2-0F5656D80559}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="TSQL INSERT INTO DWH_Registration_DM"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{B0DC49FE-B31E-4725-AD3B-5BB1D1A9DFE8}"
          SQLTask:SqlStatementSource="IF NOT EXISTS (SELECT [identityID] FROM [dwh].[Registration_DM] WHERE identityID='guest')&#xA;BEGIN&#xA;&#xA;Declare @locationId int, @registrationTypeId int, @cityId int, @countryId int&#xA;select @cityId = City_ID from [dwh].[City_DM] where [City] = 'Unknown'&#xA;select @countryId = Country_ID from [dwh].[Country_DM] where [Country_Code] = 'Unknown'&#xA;select @locationId = Location_ID from [dwh].[Location_DM] where [City_ID] = @cityId and [Country_ID] = @countryId&#xA;select @registrationTypeId = RegistrationType_ID from [dwh].[RegistrationType_DM] where [RegistrationType] = 'Unknown'&#xA;&#xA;INSERT INTO [dwh].[Registration_DM]&#xA;           ([identityID]&#xA;           ,[Location_ID]&#xA;           ,[Name]&#xA;           ,[CustomerType_ID]&#xA;           ,[Admin]&#xA;           ,[RegistrationType_ID]&#xA;           ,[isActive]&#xA;           ,[isParentConsortium]&#xA;           ,[isChildConsortium]&#xA;           ,[isMaster]&#xA;           ,[isSubordinate]&#xA;           ,[ParentMaster_identityID]&#xA;           ,[ParentMaster_ID]&#xA;           ,[DoNotCountDL]&#xA;           ,[LastUpdate_Date]&#xA;           ,[HideInReport]&#xA;           ,[NA_Import]&#xA;           ,[IsCurrent]&#xA;           ,[ValidFrom]&#xA;           ,[Proxy_ID]&#xA;           ,[MainParent_ID]&#xA;           ,[RegistrationTypeNo])&#xA;     VALUES&#xA;           ('guest'&#xA;           ,@locationId&#xA;           ,'Guest'&#xA;           ,3&#xA;           ,'n'&#xA;           ,@registrationTypeId&#xA;           ,0&#xA;           ,0&#xA;           ,0&#xA;           ,0&#xA;           ,0&#xA;           ,NULL&#xA;           ,NULL&#xA;           ,0&#xA;           ,GETDATE()&#xA;           ,0&#xA;           ,0&#xA;           ,1&#xA;           ,GETDATE()&#xA;           ,NULL&#xA;           ,1&#xA;           ,NULL)&#xA;Declare @registrationId int&#xA;select @registrationId = Registration_ID from [dwh].[Registration_DM] where [identityID] = 'guest'&#xA;update [dwh].[Registration_DM] set [MainParent_ID] = @registrationId where Registration_ID = @registrationId&#xA;END&#xA;&#xA;INSERT INTO [dwh].[Registration_DM]&#xA;           ([identityID]&#xA;           ,[Location_ID]&#xA;           ,[Name]&#xA;           ,[CustomerType_ID]&#xA;           ,[CU_Number]&#xA;           ,[Admin]&#xA;           ,[RegistrationType_ID]&#xA;&#x9;&#x9;   ,[RegistrationTypeNo]&#xA;           ,[isActive]&#xA;           ,[isParentConsortium]&#xA;           ,[isChildConsortium]&#xA;           ,[isMaster]&#xA;           ,[isSubordinate]&#xA;           ,[ParentMaster_identityID]&#xA;           ,[DoNotCountDL]&#xA;           ,[LastUpdate_Date]&#xA;           ,[HideInReport]&#xA;           ,[NA_Import]&#xA;           ,[IsCurrent]&#xA;           ,[ValidFrom]&#xA;           ,[ValidTo]&#xA;           ,[Proxy_ID])&#xA;        SELECT&#xA;&#x9;&#x9;&#x9;T.[identityID]&#xA;           ,T.[Location_ID]&#xA;           ,T.[Name]&#xA;           ,T.[CustomerType_ID]&#xA;           ,T.[CU_Number]&#xA;           ,T.[Admin]&#xA;           ,T.[RegistrationType_ID]&#xA;&#x9;&#x9;   ,T.[RegistrationTypeNo]&#xA;           ,T.[isActive]&#xA;           ,T.[isParentConsortium]&#xA;           ,T.[isChildConsortium]&#xA;           ,T.[isMaster]&#xA;           ,T.[isSubordinate]&#xA;           ,T.[ParentMaster_identityID]&#xA;           ,T.[DoNotCountDL]&#xA;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,0&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,1&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,GETDATE()&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,NULL&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;,NULL&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;FROM &#xA;&#x9;&#x9;(SELECT A.*&#xA;  FROM  [stg].[STG_Registration_DM_SA] A&#xA;  INNER JOIN DWH.Location_DM B&#xA;  ON b.Location_ID=a.Location_ID&#xA;  INNER JOIN DWH.CustomerType_DM C&#xA;  ON c.CustomerType_ID=a.CustomerType_ID&#xA;  INNER JOIN DWH.RegistrationType_DM D&#xA;  ON d.RegistrationType_ID=a.RegistrationType_ID) T&#xA;where T.[identityID] not in (select distinct [identityID] from dwh.[Registration_DM] )&#xA;AND ISNULL(T.[Location_ID],'') != ''" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\TSQL UPDATE Registration_DM"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{E36F7A4C-85A2-4507-9854-22EDE49A35F2}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="TSQL UPDATE Registration_DM"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{B0DC49FE-B31E-4725-AD3B-5BB1D1A9DFE8}"
          SQLTask:SqlStatementSource="UPDATE   [dwh].[Registration_DM]&#xA;&#x9;&#x9;SET &#xA;&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[Location_ID]&#x9;&#x9;&#x9;&#x9;&#x9;= RegSource.[Location_ID],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[isActive]&#x9;&#x9;&#x9;&#x9;&#x9;= RegSource.[isActive],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[DoNotCountDL]&#x9;&#x9;&#x9;&#x9;= RegSource.[DoNotCountDL],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[Name]&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;= RegSource.[Name],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[CustomerType_ID]&#x9;&#x9;&#x9;&#x9;= RegSource.[CustomerType_ID],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[CU_Number]&#x9;&#x9;&#x9;&#x9;&#x9;= RegSource.[CU_Number],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[Admin]&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;= RegSource.[Admin],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[RegistrationType_ID]&#x9;&#x9;&#x9;= RegSource.[RegistrationType_ID],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[RegistrationTypeNo]&#x9;&#x9;&#x9;= RegSource.[RegistrationTypeNo],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[isParentConsortium]&#x9;&#x9;&#x9;= RegSource.[isParentConsortium],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[isChildConsortium]&#x9;&#x9;&#x9;= RegSource.[isChildConsortium],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[isMaster]&#x9;&#x9;&#x9;&#x9;&#x9;= RegSource.[isMaster],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[isSubordinate]&#x9;&#x9;&#x9;&#x9;= RegSource.[isSubordinate],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[ParentMaster_identityID]&#x9;&#x9;= RegSource.[ParentMaster_identityID],&#xA;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[LastUpdate_Date]&#x9;&#x9;&#x9;&#x9;= GETDATE()&#x9;&#xA;&#xA;&#xA;&#xA;&#x9;&#x9;FROM [dwh].[Registration_DM]  INNER JOIN [stg].[STG_Registration_DM_SA] RegSource&#xA;&#x9;&#x9;ON&#x9; [dwh].[Registration_DM].[identityID]&#x9;&#x9;&#x9;&#x9;&#x9;= RegSource.[identityID]&#xA;&#xA;&#xA;&#x9;&#x9;WHERE &#xA;&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;[dwh].[Registration_DM].[Location_ID]&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; RegSource.[Location_ID]&#xA;&#x9;&#x9;&#x9;&#x9;OR [dwh].[Registration_DM].[isActive]&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; RegSource.[isActive]&#xA;&#x9;&#x9;&#x9;&#x9;OR [dwh].[Registration_DM].[DoNotCountDL]&#x9;&#x9;&#x9;&#x9;&lt;&gt; RegSource.[DoNotCountDL]&#xA;&#x9;&#x9;&#x9;&#x9;OR [dwh].[Registration_DM].[Name]&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; RegSource.[Name]&#xA;&#x9;&#x9;&#x9;&#x9;OR [dwh].[Registration_DM].[CustomerType_ID]&#x9;&#x9;&#x9;&#x9;&lt;&gt; RegSource.[CustomerType_ID]&#xA;&#x9;&#x9;&#x9;&#x9;OR [dwh].[Registration_DM].[CU_Number]&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; RegSource.[CU_Number]&#xA;&#x9;&#x9;&#x9;&#x9;OR [dwh].[Registration_DM].[Admin]&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; RegSource.[Admin]&#xA;&#x9;&#x9;&#x9;&#x9;OR [dwh].[Registration_DM].[RegistrationType_ID]&#x9;&#x9;&#x9;&lt;&gt; RegSource.[RegistrationType_ID]&#xA;&#x9;&#x9;&#x9;&#x9;OR [dwh].[Registration_DM].[RegistrationTypeNo]&#x9;&#x9;&#x9;&lt;&gt; RegSource.[RegistrationTypeNo]&#xA;&#x9;&#x9;&#x9;&#x9;OR [dwh].[Registration_DM].[isParentConsortium]&#x9;&#x9;&#x9;&lt;&gt; RegSource.[isParentConsortium]&#xA;&#x9;&#x9;&#x9;&#x9;OR [dwh].[Registration_DM].[isChildConsortium]&#x9;&#x9;&#x9;&lt;&gt; RegSource.[isChildConsortium]&#xA;&#x9;&#x9;&#x9;&#x9;OR [dwh].[Registration_DM].[isMaster]&#x9;&#x9;&#x9;&#x9;&#x9;&lt;&gt; RegSource.[isMaster]&#xA;&#x9;&#x9;&#x9;&#x9;OR [dwh].[Registration_DM].[isSubordinate]&#x9;&#x9;&#x9;&#x9;&lt;&gt; RegSource.[isSubordinate]&#xA;&#x9;&#x9;&#x9;&#x9;OR [dwh].[Registration_DM].[ParentMaster_identityID]&#x9;&#x9;&lt;&gt; RegSource.[ParentMaster_identityID]&#xA;&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:PrecedenceConstraints>
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 3]"
      DTS:CreationName=""
      DTS:DTSID="{6AF5F716-EC42-4037-A45B-95ED81658875}"
      DTS:From="Package\TSQL INSERT INTO DWH_Registration_DM"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 3"
      DTS:To="Package\TSQL UPDATE Registration_DM" />
  </DTS:PrecedenceConstraints>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--Cette section CDATA contient des informations sur la disposition du package. Elle comprend des informations telles que les coordonnées (x,y), la largeur et la hauteur.-->
<!--Si vous modifiez manuellement cette section et commettez une erreur, vous pouvez la supprimer. -->
<!--Le package pourra toujours se charger normalement, mais les informations de disposition précédente seront perdues et le concepteur réorganisera automatiquement les éléments sur l'aire de conception.-->
<Objects
  Version="8">
  <!--Chaque nœud ci-dessous contiendra des propriétés qui n'affectent pas le comportement d'exécution.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml">
        <NodeLayout
          Size="282.666666666667,42.6666666666667"
          Id="Package\TSQL INSERT INTO DWH_Registration_DM"
          TopLeft="33.5,210.833333333333" />
        <NodeLayout
          Size="228,42.6666666666667"
          Id="Package\TSQL UPDATE Registration_DM"
          TopLeft="60.8333333333334,313.5" />
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 3]"
          TopLeft="174.833333333333,253.5">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,60.0000000000001"
              Start="0,0"
              End="0,52.5000000000001">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,52.5000000000001" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>